<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" href="/media/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/media/css/editor.css" type="text/css" />

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="/media/js/sha256.js"></script>
    <script type="text/javascript" src="/media/js/aes256.js"></script>
    <script type="text/javascript" src="/media/js/doT.min.js"></script>
    <script type="text/javascript" src="/media/js/editor.js"></script>

    <title>Cryptiki.com - Client-side encryption for your content</title>
</head>

<body>

<div id="container">

<div id="header">
<div id="header_inner">
<h1>Cryptiki.com - Client-side encryption for your content</h1>
</div>
</div>

<div id="main">
<div id="main_inner">

<p>Cryptiki is a minimalistic UI and storage for encrypted text pages. Encryption is done on client side using Javascript, so no
passwords or unencrypted data are ever sent over network or stored on server.</p>

<p class="box">
Page key <input type="text" name="key" id="key" value=""/>
Password <input type="text" name="pass" id="pass"/>
<input type="button" name="load" value="Load" onclick="loadData($('#key').val(), $('#pass').val()); return false;"/>
Overwrite existing data:
<input type="button" name="load" value="Save" onclick="saveData(); return false;"/>
Switch mode:
<button id="transform">Visual</button>
</p>

<p><textarea name="content" id="content" rows="30" cols="80" style="width: 100%; height: 400px;"></textarea></p>

<div style="display: none;" id="structure"></div>

<h2>Hashes</h2>

<dl style="font-size: 80%">
  <dt>Page key</dt><dd id="keyhash"></dd>
  <dt>Password</dt><dd id="passhash"></dd>
  <dt>Content</dt><dd id="contenthash"></dd>
</dl>

</div> <!-- main_inner -->
</div> <!-- main -->

<script type="text/javascript">
//<![CDATA[

function loadData(key, pass) {
  if(key == '' || pass == '') {
    alert('Please enter page key and password first!');
    return;
  }

  var keyhash = hex_sha256(key);

  // Update page key and password fields in case we were called when user clicked an automatic link
  $('#key').val(key);
  $('#pass').val(pass);

  var request = $.ajax({
    url: "/get.php",
    data: "keyhash=" + keyhash,
    method: 'POST'
  }).done(function(res) {
    if(res.error) {
      alert(res.error);
      return;
    }

    do {
      var content = AESDecryptCtr(res.content, pass, 256)
      if(res.contenthash == hex_sha256(content)) { // success
        if(isVisual()) {
          editor.fromText(content);
          $('#structure').html(editor.toHtml());
        } else {
          $('#content').val(content);
        }

        if(content.substr(content.length - 6) == 'VISUAL') // force
          toVisual();

        $('#keyhash').html(keyhash);
        $('#passhash').html(hex_sha256(pass));
        $('#contenthash').html(res.contenthash);

        break;
      } else {
        pass = prompt('Invalid password! Please try again:');
        if(!pass) break;
        $('#pass').val(pass);
      }
    } while(true);
  });
}

function saveData() {
  var key = $('#key').val(), pass = $('#pass').val(), content;

  if(key == '' || pass == '') {
    alert('Please enter page key and password first!');
    return;
  }

  if(content == '' && !confirm('This will erase the page - are you sure?'))
    return;

  content = isVisual() ? editor.toText() : $('#content').val();

  var content_crypted = AESEncryptCtr(content, pass, 256),
    keyhash = hex_sha256(key),
    passhash = hex_sha256(pass),
    contenthash = hex_sha256(content);

  $('#keyhash').html(keyhash);
  $('#passhash').html(passhash);
  $('#contenthash').html(contenthash);

  $.ajax("/put.php", {
    data: "keyhash=" + keyhash + "&passhash=" + passhash + "&contenthash=" + contenthash + "&content=" +
      encodeURIComponent(content_crypted), // put this to avoid + turning into space and getting removed
    type: 'POST',
    success: function(resp) {
      alert(resp);
    }
  });
}

var editor = new Editor.Editor();

function toVisual() {
  editor.fromText($('#content').val());
  $('#content').hide();
  $('#structure').html(editor.toHtml());
  $('#structure').show();
  $('#transform').html('Source');
}

function toSource() {
  $('#structure').hide();
  $('#content').val(editor.toText());
  $('#content').show();
  $('#transform').html('Visual');
}

function isVisual() {
  return $('#structure').is(':visible');
}

$(document).ready(function() {
  var page = location.pathname.substr(1);

  if(page != '')
    loadData(page, 'default');

  editor.attachListeners('#structure');

  $('#transform').click(function(ev) {
    if(!isVisual())
      toVisual();
    else
      toSource();
  });
});

//]]>
</script>

<div id="footer">
<div id="footer_inner">

<div style="float: right;">
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</div>

<p>Copyright &copy; <a href="http://joonaspihlajamaa.com">Joonas Pihlajamaa</a> 2009. All rights reserved. <strong style="font-variant: small-caps;">No warranties of any kind, use purely on your own risk.</strong></p>
<p><a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> cipher routines by <a href="http://www.movable-type.co.uk/scripts/aes.html">Chris Veness</a>.
<a href="http://en.wikipedia.org/wiki/SHA_hash_functions">SHA-2</a> hash routines <a href="http://anmar.eu.org/projects/jssha2/">Angel Marin</a>.</p>

<div style="clear: both;"></div>

</div> <!-- footer_inner -->
</div> <!-- footer -->

</div> <!-- container -->

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-3381993-6");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>
